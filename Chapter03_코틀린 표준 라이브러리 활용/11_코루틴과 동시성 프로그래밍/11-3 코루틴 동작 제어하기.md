# 11-3 ì½”ë£¨í‹´ ë™ì‘ ì œì–´í•˜ê¸°



## 1. ì½”ë£¨í‹´ì˜ ë¬¸ë§¥

- ì½”ë£¨í‹´ì€ í•­ìƒ íŠ¹ì • ë¬¸ë§¥ì—ì„œ ì‹¤í–‰ : `CoroutineContext`ë¡œ êµ¬í˜„

- **ë””ìŠ¤íŒ¨ì²˜(Dispatcher)** : CoroutineDispatcher ë¼ëŠ” ì¶”ìƒ í´ë˜ìŠ¤

  - ì–´ë–¤ ë¬¸ë§¥ì—ì„œ ì½”ë£¨í‹´ì„ ì‹¤í–‰í• ì§€ ê²°ì •
  - dispatch : ë³´ë‚´ë‹¤
  - ì‚¬ìš©ìë¡œë¶€í„° ì½”ë£¨í‹´ ì‹¤í–‰ ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ ìŠ¤ë ˆë“œ í’€ì—ìˆëŠ” ì ì ˆí•œ ìŠ¤ë ˆë“œì— ì½”ë£¨í‹´ì„ ë³´ë‚´ì¤Œ (ì•Œì•„ì„œ ì‰¬ê³ ìˆëŠ” ìŠ¤ë ˆë“œ ì„ íƒ)
<img width="1022" alt="image-20220923233144638" src="https://user-images.githubusercontent.com/55802790/192146730-c942fc11-18cb-4fc5-a782-82995cd4e5cf.png">
<img width="934" alt="image-20220923233234632" src="https://user-images.githubusercontent.com/55802790/192146735-e2aaba8b-6db7-4ccd-86d7-17d4562bc3a8.png">
<img width="378" alt="image-20220923233300359" src="https://user-images.githubusercontent.com/55802790/192146739-94a2d9fa-6364-41af-8925-1f0b343e8ea4.png">


- CoroutineDispatcher ê°ì²´ ì¢…ë¥˜

  - **ê¸°ë³¸ ë¬¸ë§¥ : Dispatchers.Default**
    - CommonPool(ê¸°ë³¸ë¬¸ë§¥)ì—ì„œ ì‹¤í–‰ë˜ê³ , GlobalScopeë¡œë„ í‘œí˜„
      -  `launch(Dispatchers.Default) {...}` == `GlobalScope.launch{...}`
  - **I/Oë¥¼ ìœ„í•œ ë¬¸ë§¥** : ì…ì¶œë ¥ ìœ„ì£¼ ë™ì‘í•˜ëŠ” ì½”ë“œ (ë¸”ë¡œí‚¹ ë§ì€ íŒŒì¼, ì†Œì¼“ I/Oì²˜ë¦¬)
  - Unconfined ë¬¸ë§¥ : í˜¸ì¶œì ìŠ¤ë ˆë“œì—ì„œ ì½”ë£¨í‹´ ì‹œì‘í•˜ì§€ë§Œ ì²«ë²ˆì§¸ ì§€ì—°ì ê¹Œì§€ë§Œ ì‹¤í–‰, ì´í›„ í˜¸ì¶œëœ ì§€ì—° í•¨ìˆ˜ì— ì˜í•´ ë‹¤ì‹œ ì¬ê°œ (ê¶Œì¥âŒ)
  - **ìƒˆ ìŠ¤ë ˆë“œë¥¼ ìƒì„±í•˜ëŠ” ë¬¸ë§¥** : ì‚¬ìš©ìê°€ ì§ì ‘ ìƒˆ ìŠ¤ë ˆë“œ í’€ ë§Œë“¦, ë¹„ìš© å¤š, ì‚¬ìš©í›„ í•´ì œorì¢…ë£Œ (ì„±ëŠ¥ğŸ‘)
    - ì½”ë£¨í‹´ ë‚´ì— ë˜ ë‹¤ë¥¸ ì½”ë£¨í‹´ ì •ì˜ì‹œ ë¶€ëª¨ ìì‹ êµ¬ì¡°ê°€ ë˜ë©° ë¶€ëª¨ ì·¨ì†Œ(cancle)ì‹œ ìì‹ë„ ì¬ê·€ì ìœ¼ë¡œ ì·¨ì†Œë¨, join()ìœ¼ë¡œ ëª…ì‹œì ìœ¼ë¡œ ê¸°ë‹¤ë¦´ ìˆ˜ ìˆìŒ

- ì‹¤í–‰ ë¬¸ë§¥ ì§€ì • ì½”ë“œ ì˜ˆì‹œ 

  - ```kotlin
    fun main() = runBlocking<Unit> {
        val jobs = arrayListOf<Job>()
        jobs += launch(Dispatchers.Unconfined) { // main ìŠ¤ë ˆë“œì—ì„œ ì‘ì—…
            println("Unconfined:\t\t ${Thread.currentThread().name}")
        }
        jobs += launch(coroutineContext) { // ë¶€ëª¨ì˜ ë¬¸ë§¥, ì—¬ê¸°ì„œëŠ” runBlockingì˜ ë¬¸ë§¥
            println("coroutineContext:\t ${Thread.currentThread().name}")
        }
        jobs += launch(Dispatchers.Default) { // ë””ìŠ¤íŒ¨ì²˜ì˜ ê¸°ë³¸ê°’
            println("Default:\t\t ${Thread.currentThread().name}")
        }
        jobs += launch(Dispatchers.IO) { // ì…ì¶œë ¥ ì¤‘ì‹¬ì˜ ë¬¸ë§¥
            println("IO:\t\t ${Thread.currentThread().name}")
        }
        jobs += launch { // ì•„ë¬´ëŸ° ì¸ìê°€ ì—†ì„ ë•Œ
            println("main runBlocking: ${Thread.currentThread().name}")
        }
        jobs += launch(newSingleThreadContext("MyThread")) { // ìƒˆ ìŠ¤ë ˆë“œë¥¼ ìƒì„±í•¨
            println("MyThread:\t\t ${Thread.currentThread().name}")
        }
        jobs.forEach { it.join() }
    }
    ```

    

## 2. ê¸°ë³¸ ë™ì‘ ì œì–´í•˜ê¸°

### repeat() : ì§€ì†ì ìœ¼ë¡œ ë°˜ë³µí•˜ëŠ” ì½”ë“œ ì‘ì„±

- ì¼ì¢…ì˜ ë°ëª¬(daemon) ìŠ¤ë ˆë“œ êµ¬ì„± ê°€ëŠ¥

- ```kotlin
  fun main() = runBlocking<Unit> {
      val job = launch {
          repeat(1000) { i ->
              println("I'm sleeping $i ...")
              delay(500L)
          }
      }
      delay(1300L)
      job.cancel()
  }
  ```

  - ë©”ì¸ì´ 1.3ì´ˆ ê¸°ë‹¤ë¦° í›„ ì¢…ë£Œ

### cancle() : ì½”ë£¨í‹´ ì‘ì—… ì·¨ì†Œ

- join()ë§Œ ì“°ë©´ main()ì´ jobì„ ê¸°ë‹¤ë¦¼. ì´ë•Œ cancel() ì‚¬ìš©ì‹œ job ì·¨ì†Œí•¨

```kotlin
fun main() = runBlocking {
    val startTime = System.currentTimeMillis()
    val job = launch(Dispatchers.Default) {
        var nextPrintTime = startTime
        var i = 0
        while (i < 5) { // computation loop, just wastes CPU
            // print a message twice a second
            if (System.currentTimeMillis() >= nextPrintTime) {
                println("I'm sleeping ${i++} ...")
                nextPrintTime += 500L
            }
        }
    }
    delay(1300L) // delay a bit
    println("main: I'm tired of waiting!")
    //job.cancel() // cancel() í›„ì— join() ì•ˆí•´ì£¼ë©´ race conditionì´ ë°œìƒˆ
    job.cancelAndJoin() // cancels the job and waits for its completion
    println("main: Now I can quit.")
}
```

### finally ë¸”ë¡ì—ì„œ ì½”ë£¨í‹´ ì¢…ë£Œ ê³¼ì • ì²˜ë¦¬

```kotlin
fun main() = runBlocking<Unit> {
    val job = launch {
        try {
            repeat(1000) { i ->
                println("I'm sleeping $i ...")
                delay(500L)
            }
        } finally {
            println("Bye!")
            delay(100) // repeat()ëª‡ê°œ ìˆ˜í–‰í•˜ë‹¤ê°€ ì½”ë£¨í‹´ ì·¨ì†Œë˜ì–´ì„œ ë©”ì¸ê¹Œì§€ ì¢…ë£Œë¨
            println("another")
            // finallyì˜ ì™„ì „í•œ ì‹¤í–‰ì„ ë³´ì¥í•¨
            /*withContext(NonCancellable) {
                println("I'm running finally")
                delay(1000L)
                println("Non-cancellable") // 1 ì´ˆë¥¼ ì§€ì—°í•´ë„ ì·¨ì†Œë˜ì§€ ì•ŠëŠ”ë‹¤.
            }*/
        }
    }
    delay(1300L)
    job.cancelAndJoin() // ì‘ì—…ì„ ì·¨ì†Œí•˜ê³  ì™„ë£Œë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¼
    println("main: Quit!")
}
```

- ì¼ë°˜ì ì¸ finally ë¸”ë¡ì—ì„œ ì§€ì—°í•¨ìˆ˜ ì‚¬ìš© ë¶ˆê°€ (ì½”ë£¨í‹´ì´ ì·¨ì†Œë¨) 
  - íŒŒì¼ ë‹«ê¸°ë‚˜ í†µì‹  ì±„ë„ ë‹«ê¸° ë“±ì€ ê°€ëŠ¥
- ì‹œê°„ì´ ê±¸ë¦¬ëŠ” ì‘ì—…, ì§€ì—°í•¨ìˆ˜ ì‚¬ìš©í•  ê²½ìš° **NonCancellable** ë¬¸ë§¥ì—ì„œ ì‘ë™í•˜ë„ë¡ í•´ì•¼í•¨ `/*ì£¼ì„ë¶€ë¶„*/`



### ì½”ë£¨í‹´ì— ì¡°ê±´ì‹ ë„£ìœ¼ë©´ ì—°ì‚°ì´ ëë‚ ë•Œê¹Œì§€ ë£¨í‹´ì´ ì¤‘ë‹¨ë˜ì§€ ì•ŠìŒ

```kotlin
fun main() = runBlocking<Unit> {
    val startTime = System.currentTimeMillis()
    val job = GlobalScope.launch {
        var nextPrintTime = startTime
        var i = 0
        while (i < 5) { // ì¡°ê±´ì„ ê³„ì‚°ì— ì˜í•´ ë°˜ë³µ (ëë‚˜ê¸° ì „ê¹Œì§„ ì¢…ë£Œ ì•ˆë¨) // while(isActive) ë¡œ ë°”ê¾¸ë©´ ì¢…ë£Œë¨
            if (System.currentTimeMillis() >= nextPrintTime) {
                println("I'm sleeping ${i++} ...")
                nextPrintTime += 500L
            }
        }
    }
    delay(1300L) 
    println("main: I'm tired of waiting!")
    job.cancelAndJoin() // 1.3ì´ˆ ì§€ë‚˜ì„œ ì œì–´ê°€ ì—¬ê¸°ë¡œ ì™€ë„ while()ë¬¸ ì‹¤í–‰ì¤‘ì´ë¯€ë¡œ ì¢…ë£Œ ì•ˆë¨
    println("main: Now I can quit.") 
}
```

- while() {} ì‘ì—…ì´ ëë‚ ë•Œ ê¹Œì§€ëŠ” ë£¨í‹´ì´ ëë‚˜ì§€ ì•ŠìŒ
- job.cancelAndJoin()ì™€ ê°™ì€ ì·¨ì†Œ ì‹œê·¸ë„ë¡œ ì—°ì‚°ì„ ì¢…ë£Œì‹œí‚¤ê³  ì‹¶ìœ¼ë©´ **while(isActive)**ë¡œ ìˆ˜ì •í•˜ë©´ ë¨



### ì½”ë£¨í‹´ì˜ ì‹œê°„ ë§Œë£Œ

- ì¼ì • ì‹¤í–‰ ì‹œê°„ ë’¤ì— ì½”ë£¨í‹´ ì·¨ì†Œ : **withTimeout()**

```kotlin
fun main() = runBlocking<Unit> {
    try {
        withTimeout(1300L) { // Timeout ì˜ˆì™¸ ë°œìƒ, nullë¡œ ì²˜ë¦¬í•˜ëŠ” ê²½ìš° withTimeoutOrNullì„ ì‚¬ìš©í•œë‹¤.
            repeat(1000) { i ->
                println("I'm sleeping $i ...")
                delay(500L)
            }
        }
    } catch (e: TimeoutCancellationException) { // ì‹œê°„ ë§Œë£Œì‹œ block{}ì„ ì·¨ì†Œì‹œí‚¤ê³  ì˜¤ë¥˜ ë°œìƒì‹œí‚´
        println("timed out with $e")
    }
}
```





## 3. ì±„ë„ì˜ ë™ì‘

- ì±„ë„(Channel) : ìë£Œë¥¼ ì„œë¡œ ì£¼ê³ ë°›ê¸° ìœ„í•´ ì•½ì†ëœ ì¼ì¢…ì˜ í†µë¡œ ì—­í• , ë„Œë¸”ë¡œí‚¹ ì „ì†¡ ê°œë…

  - ë„Œë¸”ë¡œí‚¹ : Aí•¨ìˆ˜ê°€ Bí•¨ìˆ˜ í˜¸ì¶œí•´ë„ ì œì–´ê¶Œì€ ìì‹ ì´ ê°€ì§€ê³  ìˆìŒ (cf. ë¸”ë¡œí‚¹)

  - ![image-20220924002635075](../../Library/Application%20Support/typora-user-images/image-20220924002635075.png)

    

  - êµ¬í˜„ : **SendChannel, ReceiveChannel ì¸í„°í˜ì´ìŠ¤** ì´ìš©

    - ì‚¬ìš© ë°©ë²• : ì±„ë„ì„ í†µí•´ send()ë¡œ ê°’ì„ ë³´ëƒ„, receive()ì—ì„œ ê°’ì„ ë°›ìŒ
    - ë”ì´ìƒ ì „ë‹¬í•  ìš”ì†Œê°€ ì—†ìœ¼ë©´ ì±„ë„ì„ ë‹«ì„ ìˆ˜ ìˆìŒ (cf.í)
    - <img width="862" alt="image-20220924002635075" src="https://user-images.githubusercontent.com/55802790/192146745-0637044b-9970-412c-9356-5b2b2d7fb447.png">


  - ì˜ˆì œ

  - ```kotlin
    fun main() = runBlocking<Unit> {
        val channel = Channel<Int>()
        // 1. ì¼ë°˜ì ì¸ send()ì™€ receive()ì˜ ì—­í• 
        launch {
            // ì—¬ê¸°ì— ë‹¤ëŸ‰ì˜ CPU ì—°ì‚°ì‘ì—…ì´ë‚˜ ë¹„ë™ê¸° ë¡œì§ì„ ë‘˜ ìˆ˜ ìˆë‹¤.
            for (x in 1..5) channel.send(x * x)
        }
        // 5ê°œì˜ ê°’ì„ ì±„ë„ë¡œë¶€í„° ë°›ëŠ”ë‹¤
        repeat(5) { println(channel.receive()) }
        println("Done!")
    ///////////////////////////////////////////////////////////////////////////
        // 2. close()ë¡œ ë‹«ê³  ë°˜ë³µë¬¸ì„ ì‚¬ìš©í•´ ì½ê¸°
        launch {
            for (x in 1..5) channel.send(x * x)
            channel.close() // ëª¨ë‘ ë³´ë‚´ê³  ë‹«ê¸° ëª…ì‹œ
        }
        // for ë£¨í”„ë¥¼ ì‚¬ìš©í•´ ëê¹Œì§€ ì½ê¸°
        for (element in channel) println(element)
        println("Done!")
    }
    ```

    - ê²°ê³¼ : 1 4 9 16 25 Done! *2

- **ì¤‘ìš” ) ì†¡ì‹ ìì™€ ìˆ˜ì‹ ìì˜ ìƒíƒœ!**

  - **ì†¡ì‹ ìëŠ” isFullì´ true**ì´ë©´ **ì¼ì‹œì§€ì—°(suspend)**, **ìˆ˜ì‹ ìëŠ”** **isEmptyê°€ true**ì´ë©´ **ì¼ì‹œì§€ì—°** ë¨

    - ì†¡ì‹ ì: `close()`ë¡œ ë‹«ìœ¼ë©´ `isClosedForSendê°€` trueë¨

    - ìˆ˜ì‹ ì: `close()`ë¡œ ë‹«ìœ¼ë©´ `isClosedForReceive` ê°€ falseë¨

  - ì±„ë„ì€ ë²„í¼ê°€ ì—†ìŒ => send(), receive() ì˜ ì§ì„ ë§ì¶°ì¤˜ì•¼ í•¨

- ë©”ì†Œë“œ

  - `SendChannel.offer(element: E): Boolean` : ê°€ëŠ¥í•˜ë©´ ìš”ì†Œë¥¼ ì±„ë„ì— ì¶”ê°€. ì±„ë„ì´ ê½‰ ì°¨ë©´ false ë°˜í™˜
  - `ReceiveChannel.poll(): E?` : ìš”ì†Œë¥¼ ë°˜í™˜. ì±„ë„ì´ ë¹„ì–´ìˆìœ¼ë©´ nullì„ ë°˜í™˜

- í™•ì¥ëœ ì±„ë„ ìë£Œí˜•
  - **RendezvousChannel** : ë‚´ë¶€ì— ë²„í¼ë¥¼ ë‘ì§€ ì•ŠìŒ. send ë™ì‘ì€ receiveê°€ ì¦‰ê° ê°€ì ¸ê°€ê¸° ì „ê¹Œì§€ëŠ” ì¼ì‹œì¤‘ë‹¨, receiveë„ ëˆ„êµ°ê°€ sendí•˜ê¸° ì „ê¹Œì§€ ì¼ì‹œì¤‘ë‹¨
  - **ArrayChannel** : íŠ¹ì •í•œ í¬ê¸°ë¡œ ê³ ì •ëœ ë²„í¼ë¥¼ ê°€ì§„ ì±„ë„. ê½‰ ì°¨ê¸° ì „ê¹Œì§„ sendê³„ì† ê°€ëŠ¥, receiveë„ ë²„í¼ê°€ ë¹Œ ë•Œ ê¹Œì§€ ê³„ì† ë°›ê¸° ê°€ëŠ¥
  - **LinkedListChannel** : ë²„í¼ í¬ê¸° ì œí•œ ì—†ìŒ sendì‹œ ì¼ì‹œì¤‘ë‹¨ ì—†ìœ¼ë‚˜ ê³„ì†í•  ê²½ìš° ë©”ëª¨ë¦¬ ë¶€ì¡± ì˜¤ë¥˜ ê°€ëŠ¥í•¨, receiveëŠ” ë¹„ì–´ìˆìœ¼ë©´ ì ì‹œ ì¤‘ë‹¨
  - **ConflatedChannel** : ë²„í¼ëŠ” í•˜ë‚˜ì˜ ìš”ì†Œë§Œ í—ˆìš©, ëª¨ë“  sendë™ì‘ì€ ì¼ì‹œì§€ì—°ë˜ì§€ ì•ŠìŒ. but ê¸°ì¡´ì˜ ê°’ì„ ë®ì–´ ì”Œì›€



### Producer-consumer pattern ìƒì‚°ì-ì†Œë¹„ì íŒ¨í„´

- **produce : ì±„ë„ì´ ë¶™ì–´ ìˆëŠ” ì½”ë£¨í‹´,** ìƒì‚°ì ì¸¡ë©´ì˜ ì½”ë“œë¥¼ ì‰½ê²Œ êµ¬ì„± ê°€ëŠ¥. ì±„ë„ì— ê°’ì„ ë³´ë‚´ë©´ ìƒì‚°ìì„
- ì†Œë¹„ìëŠ” forë¬¸ ëŒ€ì‹  `consumeEach` í•¨ìˆ˜ë¥¼ í™•ì¥í•´ì„œ ì €ì¥ëœ ìš”ì†Œë¥¼ ì†Œë¹„ ê°€ëŠ¥

```kotlin
// ìƒì‚°ìë¥¼ ìœ„í•œ í•¨ìˆ˜ ìƒì„±
fun CoroutineScope.producer(): ReceiveChannel<Int> = produce {
    var total: Int = 0
    for (x in 1..5) {
        total += x
        send(total)
    }
}

fun main() = runBlocking {
    val result = producer()  // ê°’ì˜ ìƒì‚°
    result.consumeEach { print("$it ") } // ì†Œë¹„ì ë£¨í‹´ êµ¬ì„±
}
```

ì‹¤í–‰ ê²°ê³¼ : 1 3 6 10 15



### ë²„í¼ë¥¼ ê°€ì§„ ì±„ë„

- **ì±„ë„ì—ëŠ” ê¸°ë³¸ ë²„í¼ê°€ ì—†ìŒ** => send() í•¨ìˆ˜ ë¨¼ì € í˜¸ì¶œì‹œ receive()ê°€ ë°›ê¸° ì „ê¹Œì§€ send()ëŠ” ì¼ì‹œ ì§€ì—°ë¨
  - ë°˜ëŒ€) receive()í•¨ìˆ˜ê°€ ë¨¼ì € í˜¸ì¶œì‹œ send()ê°€ ë³´ë‚´ê¸° ì „ê¹Œì§€ receive()ëŠ” ì¼ì‹œ ì§€ì—°
  - í•´ê²°ì±… : ì±„ë„ ë²„í¼ì— í¬ê¸°ë¥¼ ì£¼ì–´ ì§€ì—° ì—†ì´ ì—¬ëŸ¬ê°œ ìš”ì†Œë¥¼ ë³´ëƒ„ **Channel()ìƒì„±ìì˜ capacity ë§¤ê°œë³€ìˆ˜** ì´ìš©

```kotlin
fun main() = runBlocking<Unit> {
    val channel = Channel<Int>(3) // ë²„í¼ capacity ê°’ì„ ì¤€ë‹¤ (3)
    val sender = launch(coroutineContext) { // ì†¡ì‹ ì ì¸¡
        repeat(10) {
            println("Sending $it")
            channel.send(it) // ì§€ì†ì ìœ¼ë¡œ ë³´ë‚´ë‹¤ê°€ ê½‰ ì°¨ë©´ ì¼ì‹œ ì§€ì—°ë¨
          // 3ê°œ ë³´ë‚´ê³  receive() í•¨ìˆ˜ì—ì„œ ë°›ì„ë•Œê¹Œì§€ ë©ˆì¶¤ (3ì€ ì•„ì§ ì•ˆë³´ë‚´ì§)
        }
    }
    delay(1000) // ì•„ë¬´ê²ƒë„ ì•ˆë°›ê³  1ì´ˆê°€ ì ì‹œ ê¸°ë‹¤ë¦° í›„
    sender.cancel() // ì†¡ì‹ ìì˜ ì‘ì—…ì„ ì·¨ì†Œ í•œë‹¤.
}
```

ì‹¤í–‰ê²°ê³¼ : Sending 0	Sending 1	Sending 2	Sending 3



### select í‘œí˜„ì‹ : ì±„ë„ì—ì„œ ê²°ê³¼ë¥¼ ë°›ì•„ì˜´

- channelì˜ íŠ¹ì„±ìƒ send-receiveëŠ” pairì´ê¸° ë•Œë¬¸ì— ì—¬ëŸ¬ê°œì˜ ì±„ë„ì¤‘ ì–´ë–¤ ì±„ë„ì´ ë¨¼ì € receiveê°€ ê°€ëŠ¥í•´ ì§ˆì§€ë¥¼ ì˜ˆìƒí•˜ê¸° ì–´ë ¤ì›€
- **ì—¬ëŸ¬ê°œì˜ ì±„ë„ì—ì„œ ê°€ì¥ ë¨¼ì € ë„ì°©í•˜ëŠ” ì±„ë„ì„ ë°›ì•„ì•¼ í• ë•Œ selectë¥¼ ì‚¬ìš©í•˜ê³ , ê·¸ ì±„ë„ì˜ ê°’ì„ êº¼ë‚¼ ë•Œ onReceive ì‚¬ìš©**

```kotlin
fun main() = runBlocking {
    val routine1 = GlobalScope.produce {
        delay(Random().nextInt(1000).toLong())
        send("A")
    }
    val routine2 = GlobalScope.produce {
        delay(Random().nextInt(1000).toLong())
        send("B")
    }
    val result = select<String> {   // routine1, 2 ì¤‘ ë¨¼ì € ìˆ˜í–‰ëœ ê²ƒì„ ë°›ê²Œ ëœë‹¤.
        routine1.onReceive { result -> result }
        routine2.onReceive { result -> result }
    }
    println("Result was $result")
}
```

ì‹¤í–‰ê²°ê³¼: Result was B
